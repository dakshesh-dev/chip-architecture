<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Architecture Schematic | Financial Accelerator</title>
    <style>
        :root {
            --bg-color: #0b0f19;
            --panel-bg: #111625;
            --border-color: #2d3b4f;
            --accent-fpga: #00f2ea; /* Cyan for high tech */
            --accent-fpga-dim: rgba(0, 242, 234, 0.1);
            --accent-cpu: #ff3366; /* Hot pink/Red for heat/slow */
            --accent-cpu-dim: rgba(255, 51, 102, 0.1);
            --text-main: #e0e6ed;
            --text-muted: #94a3b8;
            --bus-color: #3b82f6;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', Courier, monospace; /* Monospace for engineering look */
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- CONTROL BAR --- */
        nav {
            height: 60px;
            background: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
        }

        .brand {
            font-weight: bold;
            letter-spacing: 1px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-light {
            width: 8px;
            height: 8px;
            background: #00f2ea;
            border-radius: 50%;
            box-shadow: 0 0 10px #00f2ea;
        }

        .switch-container {
            display: flex;
            background: #000;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            padding: 2px;
        }

        .switch-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 8px 16px;
            border-radius: 18px;
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .switch-btn.active-fpga {
            background: var(--accent-fpga);
            color: #000;
            box-shadow: 0 0 15px var(--accent-fpga-dim);
        }

        .switch-btn.active-cpu {
            background: var(--accent-cpu);
            color: #fff;
            box-shadow: 0 0 15px var(--accent-cpu-dim);
        }

        /* --- MAIN SCHEMATIC AREA --- */
        main {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: 
                linear-gradient(rgba(45, 59, 79, 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(45, 59, 79, 0.2) 1px, transparent 1px);
            background-size: 40px 40px;
            padding: 20px;
        }

        .schematic-board {
            position: relative;
            width: 90%;
            max-width: 1000px;
            aspect-ratio: 16/9;
            border: 2px solid var(--border-color);
            background: rgba(11, 15, 25, 0.9);
            border-radius: 8px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- FPGA ARCHITECTURE (Grid View) --- */
        .arch-layer {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            display: none; /* Toggled by JS */
            padding: 20px;
        }

        /* Sections of the FPGA */
        .fpga-grid {
            display: grid;
            grid-template-columns: 150px 1fr 150px; /* I/O | Logic | Memory */
            gap: 20px;
            height: 100%;
        }

        .section-col {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: center;
        }

        .component {
            border: 1px solid var(--border-color);
            background: rgba(255,255,255,0.02);
            padding: 10px;
            font-size: 0.7rem;
            color: var(--text-muted);
            position: relative;
            text-align: center;
        }

        .component::before {
            content: attr(data-label);
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--accent-fpga);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* The Tensor Core Grid */
        .tensor-core-matrix {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 4px;
            height: 100%;
            border: 1px dashed var(--border-color);
            padding: 5px;
        }

        .dsp-unit {
            background: rgba(0, 242, 234, 0.05);
            border: 1px solid rgba(0, 242, 234, 0.2);
            position: relative;
        }

        .dsp-unit.active {
            background: #00f2ea;
            box-shadow: 0 0 10px #00f2ea;
            transition: background 0.05s;
        }

        /* --- CPU ARCHITECTURE (Serial View) --- */
        .cpu-layout {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: 100%;
            padding: 40px;
        }

        .dram-bank {
            width: 80%;
            height: 60px;
            border: 2px solid var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-weight: bold;
        }

        .bus-lines {
            width: 4px;
            flex: 1;
            background: var(--border-color);
            position: relative;
        }

        .cpu-die {
            width: 60%;
            height: 200px;
            border: 2px solid var(--accent-cpu);
            background: rgba(255, 51, 102, 0.05);
            display: flex;
            flex-wrap: wrap;
            padding: 10px;
            gap: 10px;
            justify-content: center;
            position: relative;
        }

        .alu-core {
            width: 45%;
            height: 45%;
            border: 1px solid var(--accent-cpu);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: var(--accent-cpu);
        }

        .cache-layer {
            width: 95%;
            height: 30px;
            background: #2d3b4f;
            margin-top: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: #fff;
        }

        /* --- DATA FLOW ANIMATIONS --- */
        .stream-particle {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
        }

        /* FPGA: High Speed Flow */
        .fpga-particle {
            width: 20px; /* Longer streak */
            height: 2px;
            background: linear-gradient(90deg, transparent, #00f2ea);
            box-shadow: 0 0 5px #00f2ea;
        }

        /* CPU: Data Packet */
        .cpu-particle {
            width: 8px;
            height: 8px;
            background: #ff3366;
            border-radius: 2px;
        }

        /* --- DASHBOARD OVERLAY --- */
        .telemetry {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(11, 15, 25, 0.95);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            border-radius: 8px;
        }

        .metric h3 {
            margin: 0;
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .metric p {
            margin: 5px 0 0 0;
            font-size: 1.2rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        /* --- iPad Responsive Tweaks --- */
        @media (orientation: portrait) {
            .schematic-board { aspect-ratio: auto; height: 60vh; width: 95%; }
            .fpga-grid { grid-template-columns: 1fr; grid-template-rows: 80px 1fr 80px; }
            .section-col { flex-direction: row; }
            .telemetry { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="brand">
            <div class="status-light"></div>
            ARCH.VIEWER v2.0
        </div>
        <div class="switch-container">
            <button class="switch-btn active-fpga" onclick="toggleArch('fpga')">FPGA (PARALLEL)</button>
            <button class="switch-btn" onclick="toggleArch('cpu')">CPU (SERIAL)</button>
        </div>
    </nav>

    <main>
        <div class="schematic-board" id="board">
            
            <div class="arch-layer" id="fpga-view" style="display: block;">
                <div class="fpga-grid">
                    <div class="section-col">
                        <div class="component" data-label="PCIe Gen3 x4">Input Buffer</div>
                        <div class="component" data-label="AXI Stream">DMA Engine</div>
                    </div>
                    
                    <div class="component" data-label="8x8 Tensor Processing Grid" style="display: flex; flex-direction: column;">
                        <div class="tensor-core-matrix" id="tensorGrid">
                            </div>
                    </div>

                    <div class="section-col">
                        <div class="component" data-label="BRAM Cache">4.8Mb On-Chip</div>
                        <div class="component" data-label="DDR3 Controller">Write Back</div>
                    </div>
                </div>
            </div>

            <div class="arch-layer" id="cpu-view">
                <div class="cpu-layout">
                    <div class="dram-bank">SYSTEM DRAM (SLOW)</div>
                    <div class="bus-lines" id="cpuBus"></div>
                    <div class="cpu-die">
                        <div style="width:100%; text-align:center; color:#ff3366; font-size:0.8rem; margin-bottom:5px;">i9 / THREADRIPPER DIE</div>
                        <div class="alu-core">CORE 0</div>
                        <div class="alu-core">CORE 1</div>
                        <div class="alu-core">CORE 2</div>
                        <div class="alu-core">CORE 3</div>
                        <div class="cache-layer">SHARED L3 CACHE (BOTTLENECK)</div>
                    </div>
                </div>
            </div>

            <div class="telemetry">
                <div class="metric">
                    <h3>Current Throughput</h3>
                    <p id="tps-display" style="color: #00f2ea;">83,210 TPS</p>
                </div>
                <div class="metric">
                    <h3>Latency</h3>
                    <p id="latency-display">12.1 µs</p>
                </div>
                <div class="metric">
                    <h3>Architecture Efficiency</h3>
                    <p id="eff-display">99.8%</p>
                </div>
            </div>

        </div>
    </main>

    <script>
        const tensorGrid = document.getElementById('tensorGrid');
        const fpgaView = document.getElementById('fpga-view');
        const cpuView = document.getElementById('cpu-view');
        
        const tpsDisplay = document.getElementById('tps-display');
        const latDisplay = document.getElementById('latency-display');
        const effDisplay = document.getElementById('eff-display');
        const board = document.getElementById('board');

        let activeMode = 'fpga';
        
        // 1. GENERATE FPGA CORES
        const cores = [];
        for(let i=0; i<64; i++) {
            const dsp = document.createElement('div');
            dsp.className = 'dsp-unit';
            tensorGrid.appendChild(dsp);
            cores.push(dsp);
        }

        // 2. ANIMATION LOOP
        function animate() {
            if(activeMode === 'fpga') {
                runFpgaSimulation();
            } else {
                runCpuSimulation();
            }
            requestAnimationFrame(animate);
        }

        // FPGA LOGIC: Massive Parallelism
        function runFpgaSimulation() {
            // Randomly flash cores to show calculation
            cores.forEach(core => {
                if(Math.random() > 0.7) {
                    core.classList.add('active');
                    setTimeout(() => core.classList.remove('active'), 50);
                }
            });

            // Create HIGH VOLUME data streams
            if(Math.random() > 0.2) { // Frequent generation
                createParticle('fpga');
            }

            // Update Stats to look stable and high
            tpsDisplay.innerText = (83000 + Math.floor(Math.random() * 500)).toLocaleString() + " TPS";
            tpsDisplay.style.color = "#00f2ea";
            latDisplay.innerText = (12.1 + (Math.random() * 0.1)).toFixed(2) + " µs";
            effDisplay.innerText = "99.8%";
        }

        // CPU LOGIC: Serial Bottleneck
        let cpuFrame = 0;
        function runCpuSimulation() {
            cpuFrame++;
            
            // Only create particle rarely (Low throughput)
            if(cpuFrame % 40 === 0) {
                createParticle('cpu');
            }

            // Fluctuate stats wildly
            tpsDisplay.innerText = (2000 + Math.floor(Math.random() * 300)).toLocaleString() + " TPS";
            tpsDisplay.style.color = "#ff3366";
            latDisplay.innerText = (400 + Math.floor(Math.random() * 100)).toFixed(1) + " µs";
            effDisplay.innerText = "42.5%";
        }

        // PARTICLE SYSTEM
        function createParticle(type) {
            const p = document.createElement('div');
            p.className = 'stream-particle';
            
            const rect = board.getBoundingClientRect();

            if(type === 'fpga') {
                // FPGA: Stream from left to right, multiple distinct "lanes"
                p.classList.add('fpga-particle');
                // Pick a random row (0-7) to simulate the 8 rows of the grid
                const row = Math.floor(Math.random() * 8); 
                // Calculate vertical position based on grid layout approximation
                const rowHeight = rect.height / 10; 
                
                p.style.left = '10px';
                p.style.top = (rect.height * 0.25) + (Math.random() * (rect.height * 0.5)) + 'px';
                
                // Animate
                const speed = 1000 + Math.random() * 500; // Fast (1s)
                p.animate([
                    { transform: 'translateX(0)', opacity: 1 },
                    { transform: `translateX(${rect.width}px)`, opacity: 0 }
                ], {
                    duration: speed,
                    easing: 'linear'
                }).onfinish = () => p.remove();

            } else {
                // CPU: Move Down, Stop (Cache Miss), Move Back Up
                p.classList.add('cpu-particle');
                p.style.left = '50%';
                p.style.top = '10px';

                // Complex Keyframe for bottleneck
                p.animate([
                    { top: '10px', opacity: 1 },
                    { top: '60%', opacity: 1, offset: 0.4 }, // Hit Cache
                    { top: '60%', backgroundColor: '#fff', offset: 0.5 }, // Wait (Stall)
                    { top: '60%', backgroundColor: '#ff3366', offset: 0.6 },
                    { top: '20%', opacity: 0, offset: 1 } // Return to memory
                ], {
                    duration: 2500, // Slow (2.5s)
                    easing: 'ease-in-out'
                }).onfinish = () => p.remove();
            }

            board.appendChild(p);
        }

        function toggleArch(mode) {
            activeMode = mode;
            const btns = document.querySelectorAll('.switch-btn');
            
            if(mode === 'fpga') {
                btns[0].classList.add('active-fpga');
                btns[1].classList.remove('active-cpu');
                fpgaView.style.display = 'block';
                cpuView.style.display = 'none';
                document.querySelector('.status-light').style.background = '#00f2ea';
                document.querySelector('.status-light').style.boxShadow = '0 0 10px #00f2ea';
            } else {
                btns[0].classList.remove('active-fpga');
                btns[1].classList.add('active-cpu');
                fpgaView.style.display = 'none';
                cpuView.style.display = 'block';
                document.querySelector('.status-light').style.background = '#ff3366';
                document.querySelector('.status-light').style.boxShadow = '0 0 10px #ff3366';
                
                // Clear FPGA particles
                document.querySelectorAll('.fpga-particle').forEach(p => p.remove());
            }
        }

        animate();

    </script>
</body>
</html>
